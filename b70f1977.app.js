"use strict";angular.module("lformsApp",["ngCookies","ngResource","ngSanitize","ngRoute","ngAnimate","ngMaterial","lformsWidget","angularFileUpload"]).config(["$ariaProvider",function(e){e.config({tabindex:!1,bindRoleForClick:!1})}]).config(["$routeProvider","$locationProvider",function(e,t){e.when("/lforms-fhir-app",{templateUrl:"fhir-app/fhir-app.html",controller:"FhirAppCtrl"}).when("/",{templateUrl:"fhir-app/fhir-app.html",controller:"FhirAppCtrl"}),t.html5Mode(!0)}]);var LFormsUtil=LFormsUtil||{};LFormsUtil.copyToClipboard=function(e){window.getSelection().selectAllChildren(document.getElementById(e)),document.execCommand("Copy")},angular.module("lformsApp").controller("FhirAppContentCtrl",["$scope","$window","$http","$timeout","$routeParams","selectedFormData","$mdDialog","fhirService","userMessages",function(a,e,t,n,i,r,o,s,l){var c="R4";a.initialLoad=!0,a.previewOptions={hideCheckBoxes:!0},a.lfOptions={showQuestionCode:!0,showCodingInstruction:!1,tabOnInputFieldsOnly:!1,showFormHeader:!1},a.fhirResInfo={resId:null,resType:null,resTypeDisplay:null,extensionType:null,questionnaireResId:null,questionnaireName:null},a.userMessages=l,a.valueCleanUp=function(e){for(var t=angular.copy(e),n=0,i=t.itemList.length;n<i;n++)delete t.itemList[n].value;return t},a.saveQRToFhir=function(){$(".spinner").show(),"QuestionnaireResponse"===a.fhirResInfo.resType&&(a.fhirResInfo.resId?a.updateQRToFhir(a.fhirResInfo.extensionType):a.createQRToFhir(a.fhirResInfo.extensionType))},a.deleteFromFhir=function(){$(".spinner").show(),a.fhirResInfo.resId&&s.deleteQRespAndObs(a.fhirResInfo.resId)},a.saveAsToFhir=function(e){$(".spinner").show(),"QR"===e?a.createQRToFhir():"SDC-QR"===e&&a.createQRToFhir("SDC")},a.saveAsQRExtracted=function(){$(".spinner").show();var e,t=LForms.Util.getFormFHIRData("QuestionnaireResponse",s.fhirVersion,a.formData,{extract:!0,subject:s.getCurrentPatient()});if(a.fhirResInfo.questionnaireResId){var n={id:a.fhirResInfo.questionnaireResId,name:a.fhirResInfo.questionnaireName};e=!0}else{var i=a.valueCleanUp(a.formData);n=LForms.Util.getFormFHIRData("Questionnaire",s.fhirVersion,i);e=!1}var r=t.shift();s.createQQRObs(n,r,t,e)},a.saveDRToFhir=function(){var e=LForms.FHIR.createDiagnosticReport(a.formData,s.getCurrentPatient().resource,!0,"transaction");e?s.handleTransactionBundle(e):console.log("Failed to create a DiagnosticReport. "+JSON.stringify(a.formData))},a.createQRToFhir=function(e){$(".spinner").show();var t="SDC"!==e,n=LForms.Util.getFormFHIRData("QuestionnaireResponse",s.fhirVersion,a.formData,{noExtensions:t,subject:s.getCurrentPatient()});if(n)if(delete n.id,a.fhirResInfo.questionnaireResId){var i={id:a.fhirResInfo.questionnaireResId,name:a.fhirResInfo.questionnaireName};s.createQR(n,i,e)}else{var r=a.valueCleanUp(a.formData),o=LForms.Util.getFormFHIRData("Questionnaire",s.fhirVersion,r);o?(delete o.id,s.createQQR(o,n,e)):console.log("Failed to create a Questionnaire. "+JSON.stringify(a.formData))}else console.log("Failed to create a QuestionnaireResponse. "+JSON.stringify(a.formData))},a.updateQRToFhir=function(e){$(".spinner").show();var t="SDC"!==e;if(a.fhirResInfo.resId&&a.fhirResInfo.questionnaireResId){var n=LForms.Util.getFormFHIRData("QuestionnaireResponse",s.fhirVersion,a.formData,{noExtensions:t});if(n){var i=s.getCurrentPatient();i&&(n.subject={reference:"Patient/"+i.id,display:i.name}),s.setQRRefToQ(n,{id:a.fhirResInfo.questionnaireResId}),n.id=a.fhirResInfo.resId,s.updateFhirResource("QuestionnaireResponse",n)}else console.log("Failed to update a QuestionnaireResponse. "+JSON.stringify(a.formData))}},a.showHL7Segments=function(e){a.formData&&(a.hl7String=LForms.HL7.toHL7Segments(a.formData),o.show({scope:a,preserveScope:!0,templateUrl:"fhir-app/hl7-dialog.html",parent:angular.element(document.body),targetEvent:e}))},a.showFHIRDiagnosticReport=function(e){if(a.formData){var t=LForms.Util.getFormFHIRData("DiagnosticReport",c,a.formData,{bundleType:"collection"}),n=(t=LForms.FHIR.createDiagnosticReport(a.formData,s.getCurrentPatient().resource,!0,"collection"),JSON.stringify(t,null,2));a.fhirResourceString=n,a.fhirResourceTitle="FHIR DiagnosticReport Resource",o.show({scope:a,preserveScope:!0,templateUrl:"fhir-app/fhir-resource-dialog.html",parent:angular.element(document.body),targetEvent:e})}},a.showOrigFHIRQuestionnaire=function(e){var t=s.getCurrentQuestionnaire();if(t){var n=JSON.stringify(t,null,2),i=s.getServerBaseURL();n=n.replace(/"id": "([^\s"]+)"/,'"id": "<a href="'+i+'/Questionnaire/$1" target=_blank>$1</a>'),a.fhirResourceString=n,a.fhirResourceTitle="Questionnaire Resource from FHIR Server",o.show({scope:a,preserveScope:!0,templateUrl:"fhir-app/fhir-resource-dialog.html",parent:angular.element(document.body),targetEvent:e})}},a.showFHIRQuestionnaire=function(e){if(a.formData){var t=a.valueCleanUp(a.formData),n=LForms.Util.getFormFHIRData("Questionnaire",c,t,{noExtensions:!0}),i=JSON.stringify(n,null,2);i=i.replace(/"id": "(\d+)"/,'"id": "<a href="'+a.serverBaseURL+'/Questionnaire/$1">Questionnaire/$1</a>'),a.fhirResourceString=i,a.fhirResourceTitle="FHIR Questionnaire Resource",o.show({scope:a,preserveScope:!0,templateUrl:"fhir-app/fhir-resource-dialog.html",parent:angular.element(document.body),targetEvent:e})}},a.showFHIRSDCQuestionnaire=function(e){if(a.formData){var t=a.valueCleanUp(a.formData),n=LForms.Util.getFormFHIRData("Questionnaire",c,t),i=JSON.stringify(n,null,2);a.fhirResourceString=i,a.fhirResourceTitle="FHIR SDC Questionnaire Resource",o.show({scope:a,preserveScope:!0,templateUrl:"fhir-app/fhir-resource-dialog.html",parent:angular.element(document.body),targetEvent:e})}},a.showFHIRQuestionnaireResponse=function(e){if(a.formData){var t=LForms.Util.getFormFHIRData("QuestionnaireResponse",c,a.formData,{noExtensions:!0,subject:s.getCurrentPatient()}),n=JSON.stringify(t,null,2);a.fhirResourceString=n,a.fhirResourceTitle="FHIR QuestionnaireResponse Resource",o.show({scope:a,preserveScope:!0,templateUrl:"fhir-app/fhir-resource-dialog.html",parent:angular.element(document.body),targetEvent:e})}},a.showFHIRSDCQuestionnaireResponse=function(e){if(a.formData){var t=LForms.Util.getFormFHIRData("QuestionnaireResponse",c,a.formData,{subject:s.getCurrentPatient()}),n=JSON.stringify(t,null,2);a.fhirResourceString=n,a.fhirResourceTitle="FHIR SDC QuestionnaireResponse Resource",o.show({scope:a,preserveScope:!0,templateUrl:"fhir-app/fhir-resource-dialog.html",parent:angular.element(document.body),targetEvent:e})}},a.closeDialog=function(){o.hide()},a.copyToClipboard=function(e){LFormsUtil.copyToClipboard(e)},a.$on("LF_FHIR_QR_CREATED",function(e,t){a.fhirResInfo.resId=t.resId,a.fhirResInfo.resType=t.resType,t.qResId&&(a.fhirResInfo.questionnaireResId=t.qResId,a.fhirResInfo.questionnaireName=t.qName),a.fhirResInfo.extensionType=t.extensionType,"QuestionnaireResponse"===t.resType&&t.extensionType?a.fhirResInfo.resTypeDisplay=t.resType+" ("+t.extensionType+")":a.fhirResInfo.resTypeDisplay=t.resType,$(".spinner").hide()}),a.$on("LF_FHIR_RESOURCE_DELETED",function(e,t){r.setFormData(null),a.initialLoad=!0,a.$apply(),$(".spinner").hide()}),a.$on("LF_NEW_DATA",function(){var e=r.getFormData();e&&(e.templateOptions.showFormHeader=!1),a.fhirResInfo=r.getFhirResInfo(),a.formData=e,a.initialLoad&&e&&(a.initialLoad=!1),$(".spinner").hide()})}]),angular.module("lformsApp").controller("NavBarCtrl",["$scope","$http","$mdDialog","selectedFormData","fhirService","FileUploader","userMessages","$timeout",function(g,e,t,s,h,n,l,o){function c(){for(var e=Object.keys(l),t=0,n=e.length;t<n;++t)delete l[e[t]]}g.search={},g.uploader=new n({removeAfterUpload:!0}),g.listSavedQR=null,g.listSavedQ=null,g.formSelected={},g.obrItems=[{question:"Effective Date",questionCode:"date_done",dataType:"DT",answers:"",_answerRequired:!0,answerCardinality:{min:"1",max:"1"},displayControl:{colCSS:[{name:"width",value:"100%"},{name:"min-width",value:"4em"}]}}],g.loadFromFile=function(){document.querySelector("#inputAnchor").click()},g.uploader.onAfterAddingFile=function(e){s.setFormData(null),o(function(){c()});var t=new FileReader;t.onload=function(e){try{var t=JSON.parse(e.target.result)}catch(e){o(function(){l.error=e})}if(t)if(t.resourceType&&"Questionnaire"===t.resourceType){var n;try{var i=LForms.Util.detectFHIRVersion(t);if(!i){i=LForms.Util.guessFHIRVersion(t);var r='specified via meta.profile (see documentation for versioning <a href="http://build.fhir.org/versioning.html#mp-version">resources</a> and <a href="https://www.hl7.org/fhir/references.html#canonical">canonical URLs</a>).</p><p>Example 1:  http://hl7.org/fhir/3.5/StructureDefinition/Questionnaire (for Questionnaire version 3.5).<br>Example 2:  http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire|3.5.0  (for SDC Questionnaire version 3.5).</p>';o(i?function(){l.htmlWarning="<p>Warning:  Assuming this resource is for FHIR version "+i+".To avoid this warning, please make sure the FHIR version is "+r}:function(){l.htmlError="<p>Could not determine the FHIR version for this resource.  Please make sure it is "+r})}console.log("fhirVersion for uploaded Questionnaire = "+i),i=LForms.Util.validateFHIRVersion(i),n=LForms.Util.convertFHIRQuestionnaireToLForms(t,i)}catch(e){o(function(){l.error=e})}n&&o(function(){s.setFormData(new LForms.LFormsData(n))})}else o(function(){s.setFormData(new LForms.LFormsData(t))})},t.readAsText(e._file),$("#inputAnchor")[0].value=""},g.pagingLinks={Questionnaire:{previous:null,next:null},QuestionnaireResponse:{previous:null,next:null}},g.hasPagingLink=function(e,t){return g.pagingLinks[e][t]},g.getPage=function(e,t){var n=g.pagingLinks[e][t];n&&h.getPage(e,t,n)},g.processPagingLinks=function(e,t){for(var n={previous:null,next:null},i=0,r=t.length;i<r;i++){var o=t[i];"previous"!==o.relation&&"next"!==o.relation||(n[o.relation]=o.url)}g.pagingLinks[e]=n},g.showSavedQQR=function(e,t){if(t&&"QuestionnaireResponse"===t.resType){$(".spinner").show(),c(),s.setFormData(null),g.formSelected={groupIndex:1,formIndex:e};var n,i=h.fhirVersion;try{var r=LForms.Util.convertFHIRQuestionnaireToLForms(t.questionnaire,i),o=new LForms.LFormsData(r);n=LForms.Util.mergeFHIRDataIntoLForms("QuestionnaireResponse",t.questionnaireresponse,o,i)}catch(e){console.error(e),l.error="Sorry.  Could not process that QuestionnaireResponse.  See the console for details."}if(n){var a={resId:t.resId,resType:t.resType,resTypeDisplay:t.resTypeDisplay,extensionType:t.extensionType,questionnaireResId:t.questionnaire.id,questionnaireName:t.questionnaire.name};s.setFormData(new LForms.LFormsData(n),a),h.setCurrentQuestionnaire(t.questionnaire)}}},g.showSavedQuestionnaire=function(n,i){i&&"Questionnaire"===i.resType&&($(".spinner").show(),c(),s.setFormData(null),o(function(){g.formSelected={groupIndex:2,formIndex:n};try{var e=LForms.Util.convertFHIRQuestionnaireToLForms(i.questionnaire,h.fhirVersion)}catch(e){l.error=e}if(!l.error){var t={resId:null,resType:null,resTypeDisplay:null,extensionType:null,questionnaireResId:i.resId,questionnaireName:i.questionnaire.name};s.setFormData(new LForms.LFormsData(e),t),h.setCurrentQuestionnaire(i.questionnaire)}},10))},g.isSelected=function(e,t){var n="";return g.formSelected&&g.formSelected.groupIndex===e&&g.formSelected.formIndex===t&&(n="active"),n};var v="MM/dd/yyyy HH:mm:ss";g.$on("LF_FHIR_QUESTIONNAIRERESPONSE_LIST",function(e,t,n){if(g.listSavedQR=[],!(g.listSavedQRError=n)&&t&&0<t.total){for(var i=0,r=t.entry.length;i<r;i++){var o=t.entry[i].resource;if("QuestionnaireResponse"===o.resourceType){var a;o.meta&&o.meta.lastUpdated?a=new Date(o.meta.lastUpdated).toString(v):o.authored&&(a=new Date(o.authored).toString(v));var s=null,l=null,c=o.questionnaire&&o.questionnaire.reference?o.questionnaire.reference:o.questionnaire;if(c){var d=c.slice("Questionnaire".length+1);s=h.findQuestionnaire(t,d)}if(s){l=s.name;var u=new RegExp("http://hl7.org/fhir/u./sdc/StructureDefinition/sdc-questionnaire\\|(\\d+.?\\d+)"),p=null;if(o.meta&&o.meta.profile)for(var f=0,m=o.meta.profile.length;f<m;f++)o.meta.profile[f].match(u)&&(p="SDC");g.listSavedQR.push({resId:o.id,resName:l,updatedAt:a,resType:"QuestionnaireResponse",questionnaire:s,questionnaireresponse:o,extensionType:p,resTypeDisplay:p?"QuestionnaireResponse (SDC)":"QuestionnaireResponse"})}}}g.processPagingLinks("QuestionnaireResponse",t.link),$(".spinner").hide()}g.$apply()}),g.$on("LF_FHIR_QUESTIONNAIRE_LIST",function(e,t,n){if(g.listSavedQ=[],g.listSavedQError=n,t&&0<t.total){for(var i=0,r=t.entry.length;i<r;i++){var o,a=t.entry[i].resource;a.meta&&a.meta.lastUpdated?o=new Date(a.meta.lastUpdated).toString(v):a.date&&(o=new Date(a.date).toString(v)),g.listSavedQ.push({resId:a.id,resName:a.name,updatedAt:o,resType:"Questionnaire",questionnaire:a,resTypeDisplay:"Questionnaire"})}g.processPagingLinks("Questionnaire",t.link)}g.$apply(),$(".spinner").hide()}),g.$on("LF_FHIR_RESOURCE_DELETED",function(e,t){var n=h.getCurrentPatient();h.getAllQRByPatientId(n.id),h.getAllQ(),g.formSelected={},$(".spinner").hide()}),g.$on("LF_FHIR_Q_CREATED",function(e,t){h.getAllQ(),g.formSelected={groupIndex:2,formIndex:0},$(".spinner").hide()}),g.$on("OP_RESULTS",function(e,t){if(t&&t.successfulResults){var n=h.getCurrentPatient();h.getAllQRByPatientId(n.id),h.getAllQ(),g.formSelected={groupIndex:1,formIndex:0}}$(".spinner").hide()}),g.$on("LF_FHIR_RESOURCE_UPDATED",function(e,t){var n=h.getCurrentPatient();h.getAllQRByPatientId(n.id),g.formSelected={groupIndex:1,formIndex:0},$(".spinner").hide()}),g.selectedQuestionnaire=null,g.showQuestionnairePicker=function(e){g.selectedQuestionnaireInDialog=null,t.show({scope:g,preserveScope:!0,templateUrl:"fhir-app/questionnaire-select-dialog.html",parent:angular.element(document.body),targetEvent:e,controller:["$scope","$mdDialog",function(t,n){t.dialogTitle="Questionnaire Picker",t.dialogLabel="Choose a Questionnaire",t.dialogHint="Search for Questionnaires by name",t.closeDialog=function(){t.selectedQuestionnaireInDialog=null,n.hide()},t.confirmAndCloseDialog=function(){t.selectedQuestionnaire=angular.copy(t.selectedQuestionnaireInDialog.resource);var e=LForms.Util.convertFHIRQuestionnaireToLForms(t.selectedQuestionnaire);s.setFormData(new LForms.LFormsData(e)),h.setCurrentQuestionnaire(t.selectedQuestionnaire),t.selectedQuestionnaireInDialog=null,n.hide()}}]})},g.differentQuestionnaire=function(e,t){return e&&t&&e.id!==t.id},g.searchQuestionnaireByName=function(e){return h.searchQuestionnaireByName(e)}}]),angular.module("lformsApp").controller("FhirAppCtrl",["$scope","$timeout","$http","$location","$mdDialog","fhirService",function(d,e,t,n,i,r){function o(t,n){d.showWaitMsg("Contacting FHIR server.  Please wait..."),r.setNonSmartServer(t,function(e){n&&n(e),e?d.showPatientPicker():d.showErrorMsg("Could not establish communication with the FHIR server at "+t+".")})}d.getCurrentPatient=function(){return r.getCurrentPatient()},d.getPatientName=function(){return r.getPatientName()},d.getPatientGender=function(){return r.getCurrentPatient().gender},d.getPatientDob=function(){return r.getCurrentPatient().birthDate},d.getPatientPhone=function(){return r.getPatientPhoneNumber()},e(function(){d.establishFHIRContext()},1e3),d.establishFHIRContext=function(){var e=n.search().server;e?o(e):r.getSmartConnection()||r.smartConnectionInProgress()||r.requestSmartConnection(function(e){var t;e?r.getSmartConnection().patient.read().then(function(e){r.setCurrentPatient(e),r.getAllQRByPatientId(e.id),r.getAllQ(),d.$apply()}):(console.log("Could not establish a SMART connection."),(t=n.search().server)?o(t):d.showFHIRServerPicker())})},d.showPatientPicker=function(e){d.selectedPatientInDialog=null,i.show({scope:d,preserveScope:!0,templateUrl:"fhir-app/patient-select-dialog.html",parent:angular.element(document.body),targetEvent:e,controller:["$scope","$mdDialog",function(t,n){t.dialogTitle="Patient Picker",t.dialogLabel="Choose a Patient",t.dialogHint="Search for patients by name",t.closeDialog=function(){t.selectedPatientInDialog=null,n.hide()},t.confirmAndCloseDialog=function(){var e=t.selectedPatientInDialog.resource;e&&(r.setCurrentPatient(e),r.getAllQRByPatientId(e.id),r.getAllQ()),t.selectedPatientInDialog=null,n.hide()}}]})},d.showSaveResults=function(n){i.show({scope:d,preserveScope:!0,templateUrl:"fhir-app/save-results-dialog.html",parent:angular.element(document.body),controller:["$scope","$mdDialog",function(e,t){e.dialogTitle="Save Results",e.resultData=n,e.resultDataJSON=JSON.stringify(n,null,2),e.serverBaseURL=r.getServerBaseURL(),e.closeDialog=function(){e.selectedPatientInDialog=null,t.hide()}}]})},d.showFHIRServerPicker=function(e){d.selectedServerInDialog=null,i.show({scope:d,preserveScope:!0,templateUrl:"fhir-app/fhir-server-select-dialog.html",parent:angular.element(document.body),targetEvent:e,controller:["$scope","$mdDialog",function(t,n){t.dialogTitle="FHIR Server Needed",t.fhirServerListOpts={listItems:[{text:"https://launch.smarthealthit.org/v/r3/fhir"},{text:"https://lforms-fhir.nlm.nih.gov/baseDstu3"},{text:"https://lforms-fhir.nlm.nih.gov/baseR4"}]},t.closeDialog=function(){t.selectedServerInDialog=null,n.hide()},t.confirmAndCloseDialog=function(){var e=t.selectedServerInDialog&&t.selectedServerInDialog.text;e&&o(e,function(){n.hide()}),t.selectedServerInDialog=null,n.hide()}}]})},d.$on("OP_FAILED",function(e,t){$(".spinner").hide();var n=t.errInfo;if(n&&n.error&&n.error.responseJSON&&n.error.responseJSON.issue){for(var i=n.error.responseJSON.issue,r='Unable to "'+t.operation+'" '+t.resType+".",o=!1,a=0,s=i.length;a<s&&!o;++a){var l=i[a];if("error"==l.severity||"fatal"==l.severity){var c=l.details&&l.details.text||l.diagnostics;c&&(r=c),o=!0}}console.log(r),d.showErrorMsg(r)}}),d.$on("OP_RESULTS",function(e,t){$(".spinner").hide(),d.showSaveResults(t)}),d.showErrorMsg=function(e){this.showMsg("Error",e)},d.showMsg=function(e,t){i.show(i.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(e).textContent(t).ariaLabel(e+" Dialog").ok("OK"))},d.showWaitMsg=function(e){this.showMsg("Please Wait",e)},d.searchPatientByName=function(e){return r.searchPatientByName(e)}}]);var fb=angular.module("lformsApp");fb.service("fhirService",["$rootScope","$q","$http","$window",function(c,e,t,o){var d=this;d.currentPatient=null,d.connection=null,d.fhir=null,d.currentQuestionnaire=null;var u=[],p=null;function l(e,t,n){c.$broadcast("OP_FAILED",{resType:e,operation:t,errInfo:n})}function f(){c.$broadcast("OP_RESULTS",{successfulResults:JSON.parse(JSON.stringify(u)),error:JSON.parse(JSON.stringify(p))}),u=[],p=null}function m(e,i){function r(){d.fhir.create({resource:e}).then(function(e){c.$broadcast("LF_FHIR_Q_CREATED",{resType:"Questionnaire",resource:e.data,resId:e.data.id,extensionType:"SDC"}),i(e.data)},function(e){p={resType:"Questionnaire",operation:"create",errInfo:e},f()})}var t;t?d.fhir.search({type:"Questionnaire",query:t,headers:{"Cache-Control":"no-cache"}}).then(function(e){var t=e.data;if(0<(t.entry&&t.entry.length||0)){var n=t.entry[0].resource;i(n)}else r()},function(e){p={resType:"Questionnaire",operation:"search",errInfo:e},f()}):r()}d.requestSmartConnection=function(t){d.connection=null,d._connectionInProgress||(d._connectionInProgress=!0,FHIR.oauth2.ready(function(e){d.setSmartConnection(e),d._connectionInProgress=!1,t(!0)},function(){t(!1)}))},d.smartConnectionInProgress=function(){return d._connectionInProgress},d.setSmartConnection=function(n){d.connection=n,d.fhir=n.patient.api,LForms.Util.setFHIRContext({getCurrent:function(e,t){0<=e.indexOf("Patient")&&n.patient.read().then(function(e){t(e)})},getFHIRAPI:function(){return d.fhir}}),LForms.Util.getServerFHIRReleaseID(function(e){d.fhirVersion=e})},d.setNonSmartServer=function(e,t){try{d.connection={server:{serviceUrl:e}},d.fhir=FHIR.client({serviceUrl:e}).api,d.nonSmartContext={baseURL:e,getCurrent:function(e,t){0<=e.indexOf("Patient")&&setTimeout(function(){t(d.currentPatient)})},getFHIRAPI:function(){return d.fhir}},LForms.Util.setFHIRContext(d.nonSmartContext),LForms.Util.getServerFHIRReleaseID(function(e){void 0!==e?(d.fhirVersion=e,t(!0)):t(!1)})}catch(e){throw t(!1),e}},d.getSmartConnection=function(){return d.connection},d.getServerBaseURL=function(){return d.getSmartConnection().server.serviceUrl},d.setCurrentQuestionnaire=function(e){d.currentQuestionnaire=e,c.$broadcast("LF_FHIR_QUESTIONNAIRE_SELECTED",{resource:e})},d.getCurrentQuestionnaire=function(){return d.currentQuestionnaire},d.setCurrentPatient=function(e){d.currentPatient=e,d.nonSmartContext&&(d.fhir=FHIR.client({serviceUrl:d.nonSmartContext.baseURL,patientId:e.id}).patient.api)},d.getCurrentPatient=function(){return d.currentPatient},d.getPatientName=function(e){var t=e||d.currentPatient,n="";return t&&t.name&&0<t.name.length&&(t.name[0].given&&t.name[0].family?n=t.name[0].given[0]+" "+t.name[0].family:t.name[0].family?n=t.name[0].family:t.name[0].given&&(n=t.name[0].given[0])),n},d.getPatientPhoneNumber=function(e){var t=e||d.currentPatient,n="";if(t&&t.telecom)for(var i=0,r=t.telecom.length;i<r;i++)if("phone"===t.telecom[i].system&&t.telecom[i].value){n=t.telecom[i].use?t.telecom[i].use+": "+t.telecom[i].value:t.telecom[i].value;break}return n},d.getPage=function(t,e,n){var i,r=o.location.origin+"/fhir-api?";n=n.replace(/^.*\/baseDstu3\?/,r);"next"===e?i=d.fhir.nextPage:"previous"===e&&(i=d.fhir.prevPage),i({bundle:{resourceType:"Bundle",type:"searchset",link:[{relation:e,url:n}]}}).then(function(e){"Questionnaire"===t?c.$broadcast("LF_FHIR_QUESTIONNAIRE_LIST",e.data):"QuestionnaireResponse"===t&&c.$broadcast("LF_FHIR_QUESTIONNAIRERESPONSE_LIST",e.data)},function(e){console.log(e)})},d.searchPatientByName=function(e){return d.fhir.search({type:"Patient",query:{name:e},headers:{"Cache-Control":"no-cache"}}).then(function(e){var t=[];if(e&&e.data.entry)for(var n=0,i=e.data.entry.length;n<i;n++){var r=e.data.entry[n].resource;t.push({name:d.getPatientName(r),gender:r.gender,dob:r.birthDate,phone:d.getPatientPhoneNumber(r),id:r.id,resource:r})}return t},function(e){console.log(e)})},d.searchQuestionnaireByName=function(e){return d.fhir.search({type:"Questionnaire",query:{name:e},headers:{"Cache-Control":"no-cache"}}).then(function(e){var t=[];if(e&&e.data.entry)for(var n=0,i=e.data.entry.length;n<i;n++){var r=e.data.entry[n].resource;t.push({name:r.name,status:r.status,id:r.id,resource:r})}return t},function(e){console.log(e)})},d.getFhirResourceById=function(t,n){d.fhir.read({type:t,id:n}).then(function(e){c.$broadcast("LF_FHIR_RESOURCE",{resType:t,resource:e.data,resId:n})},function(e){console.log(e)})},d.getMergedQQR=function(e,t){d.fhir.search({type:e,query:{_id:t,_include:"QuestionnaireResponse:questionnaire"},headers:{"Cache-Control":"no-cache"}}).then(function(e){var t={qResource:null,qrResource:null},n=e.data.entry.length;if(0===n);else if(1===n||2===n)for(var i=0;i<n;i++){var r=e.data.entry[i].resource;"QuestionnaireResponse"===r.resourceType?t.qrResource=r:"Questionnaire"===r.resourceType&&(t.qResource=r)}c.$broadcast("LF_FHIR_MERGED_QQR",t)},function(e){console.log(e)})},d.setQRRefToQ=function(e,t){var n=t.id;"STU3"===d.fhirVersion?e.questionnaire={reference:"Questionnaire/"+n}:e.questionnaire="Questionnaire/"+n},d.createQR=function(e,t){d.setQRRefToQ(e,t),d.fhir.create({resource:e}).then(function(e){c.$broadcast("LF_FHIR_QR_CREATED",{resType:"QuestionnaireResponse",resource:e.data,resId:e.data.id,qResId:t.id,qName:t.name,extensionType:"SDC"}),u.push(e),f()},function(e){console.log(e),p=e,f()})},d.createQQRObs=function(e,t,n,i){p=null;var r={resourceType:"Bundle",type:"transaction",entry:[]};r.entry.push({resource:t,request:{method:"POST",url:"QuestionnaireResponse"}});for(var o=0,a=n.length;o<a;++o)r.entry.push({resource:n[o],request:{method:"POST",url:"Observation"}});function s(s){var l=r.entry[0].resource,e="Questionnaire/"+s.id;"STU3"==d.fhirVersion?l.questionnaire={reference:e}:l.questionnaire=e,d.fhir.transaction({bundle:r}).then(function(e){u.push(e),f();for(var t=e.data.entry,n=null,i=0,r=t.length;i<r&&!n;++i){var o=t[i],a=o.response&&o.response.location&&o.response.location.match(/^QuestionnaireResponse\/(\d+)/);a&&(n=a[1])}c.$broadcast("LF_FHIR_QR_CREATED",{resType:"QuestionnaireResponse",resource:l,resId:n,qResId:s.id,qName:s.name,extensionType:"SDC"})},function(e){p={resType:"Bundle",operation:"create",errInfo:e},f()})}i?s(e):m(e,s)},d.createQQR=function(e,t,n){m(e,function(e){d.createQR(t,e)})},d.updateFhirResource=function(t,n){d.fhir.update({resource:n}).then(function(e){c.$broadcast("LF_FHIR_RESOURCE_UPDATED",{resType:t,resource:e.data,resId:n.id})},function(e){console.log(e),l(t,"update",e)})},d.deleteQRespAndObs=function(s){"STU3"===d.fhirVersion?d.deleteFhirResource("QuestionnaireResponse",s):d.fhir.search({type:"Observation",query:{"derived-from":"QuestionnaireResponse/"+s},headers:{"Cache-Control":"no-cache"}}).then(function(e){var t=e.data.entry;if(t&&0<t.length)for(var n=0,i=!1,r=0,o=t.length;r<o;++r){var a=t[r].resource.id;++n,d.fhir.delete({type:"Observation",id:a}).then(function(e){0===--n&&d.deleteFhirResource("QuestionnaireResponse",s)},function(e){i||(i=!0,console.log(e),l("QuestionnaireResponse","delete",e))})}else d.deleteFhirResource("QuestionnaireResponse",s)},function(e){console.log(e),l("QuestionnaireResponse","delete",e)})},d.deleteFhirResource=function(t,n){d.fhir.delete({type:t,id:n}).then(function(e){c.$broadcast("LF_FHIR_RESOURCE_DELETED",{resType:t,resource:null,resId:n})},function(e){console.log(e),l(t,"delete",e)})},d.getDRAndObxBundle=function(e,t){d.fhir.search({type:"DiagnosticReport",query:{_id:t,_include:"DiagnosticReport:result"},headers:{"Cache-Control":"no-cache"}}).then(function(e){c.$broadcast("LF_FHIR_DR_OBX_BUNDLE",e.data)},function(e){console.log(e)})},d.handleTransactionBundle=function(e){d.fhir.transaction({bundle:e}).then(function(e){c.$broadcast("LF_FHIR_BUNDLE_PROCESSED",{resType:"Bundle",resource:e.data,resId:e.data.id,qResId:qID,qName:qData.name,extensionType:extensionType})},function(e){console.log(e),l("Bundle","create",e)})},d.getAllQRByPatientId=function(e){d.fhir.search({type:"QuestionnaireResponse",query:{subject:"Patient/"+e,_include:"QuestionnaireResponse:questionnaire",_sort:"-_lastUpdated",_count:5},headers:{"Cache-Control":"no-cache"}}).then(function(e){c.$broadcast("LF_FHIR_QUESTIONNAIRERESPONSE_LIST",e.data)},function(e){c.$broadcast("LF_FHIR_QUESTIONNAIRERESPONSE_LIST",null,e),console.log(e)})},d.findQuestionnaire=function(e,t){var n=null;if(e)for(var i=0,r=e.entry.length;i<r;i++){var o=e.entry[i].resource;if("Questionnaire"===o.resourceType&&o.id===t){n=o;break}}return n},d.getAllQ=function(){d.fhir.search({type:"Questionnaire",query:{_sort:"-_lastUpdated",_count:10},headers:{"Cache-Control":"no-cache"}}).then(function(e){c.$broadcast("LF_FHIR_QUESTIONNAIRE_LIST",e.data)},function(e){c.$broadcast("LF_FHIR_QUESTIONNAIRE_LIST",null,e),console.log(e)})}}]),angular.module("lformsApp").service("selectedFormData",["$rootScope",function(n){var i={lfData:null,fhirResInfo:{resId:null,resType:null,resTypeDisplay:null,extensionType:null,questionnaireResId:null,questionnaireName:null}};return{getFormData:function(){return i.lfData},getFhirResInfo:function(){return i.fhirResInfo},getFhirResourceId:function(){return i.fhirResInfo.resId},getFhirResourceType:function(){return i.fhirResInfo.resType},setFormData:function(e,t){i.lfData=e,i.fhirResInfo=t||{resId:null,resType:null,resTypeDisplay:null,extensionType:null,questionnaireResId:null,questionnaireName:null},n.$broadcast("LF_NEW_DATA")}}}]),angular.module("lformsApp").service("userMessages",["$rootScope",function(e){return{}}]),angular.module("lformsApp").run(["$templateCache",function(e){e.put("fhir-app/fhir-app-content.html",'<div class=demo-app ng-controller=FhirAppContentCtrl>\x3c!--<p class="status-bar" ng-if="formData">--\x3e\x3c!--<span class="status-label" flex="50">--\x3e\x3c!--<span class="">Resource Type:</span>--\x3e\x3c!--<span class="text-primary">{{fhirResInfo.resTypeDisplay}}</span>--\x3e\x3c!--</span>--\x3e\x3c!--<span class="status-label" flex="50">--\x3e\x3c!--<span class="">Resource ID:</span>--\x3e\x3c!--<span class="text-primary">{{fhirResInfo.resId}}</span>--\x3e\x3c!--</span>--\x3e\x3c!--</p>--\x3e<div class="btn-group btn-group-sm" role=group ng-if=formData><button ng-if="formData && fhirResInfo.resId" type=button class="btn btn-primary" ng-click=saveQRToFhir() id=btn-save data-toggle=tooltip data-placement=bottom title="Save/Update the form data as a FHIR resource to the selected FHIR server."><span class="glyphicon glyphicon-cloud-upload"></span> <span>Save</span></button> <button ng-if="formData && fhirResInfo.resId" type=button class="btn btn-primary" ng-click=deleteFromFhir() id=btn-delete data-toggle=tooltip data-placement=bottom title="Delete the FHIR resource from the selected FHIR server."><span class="glyphicon glyphicon-trash"></span> <span>Delete</span></button></div><div class="btn-group btn-group-sm" role=group ng-if=formData><button type=button class="btn dropdown-toggle btn-primary" data-toggle=dropdown aria-haspopup=true aria-expanded=false id=btn-save-as data-toggle=tooltip data-placement=bottom title="Save the form data as a \'new\' FHIR resource to the selected FHIR server."><span class="glyphicon glyphicon-share"></span> <span>Save As ... </span><span class=caret></span></button><ul class=dropdown-menu>\x3c!--<li><a href="#" class="" id="btn-save-qr" ng-click="saveAsToFhir(\'QR\')">FHIR QuestionnaireResponse</a></li>--\x3e<li><a href=# id=btn-save-sdc-qr ng-click="saveAsToFhir(\'SDC-QR\')">FHIR QuestionnaireResponse (SDC)</a></li><li><a href=# id=btn-save-sdc-qr-obs ng-click=saveAsQRExtracted()>FHIR QuestionnaireResponse (SDC) &amp; Observations</a></li>\x3c!--<li><a href="#" class="" ng-click="saveAsToFhir(\'DR\')">FHIR DiagnosticReport</a></li>--\x3e</ul></div><div class="btn-group btn-group-sm" role=group ng-if=formData><button type=button class="btn dropdown-toggle btn-primary" data-toggle=dropdown aria-haspopup=true aria-expanded=false id=btn-show-as data-toggle=tooltip data-placement=bottom title="Show\n     the form data as a FHIR resource in a popup window."><span class="glyphicon glyphicon-modal-window"></span> <span>Show As ... </span><span class=caret></span></button><ul class=dropdown-menu><li ng-if=fhirResInfo.questionnaireResId><a id=show-q-from-server href=# ng-click=showOrigFHIRQuestionnaire()>FHIR Questionnaire from Server</a></li><li ng-if=fhirResInfo.questionnaireResId role=separator class=divider></li>\x3c!--<li><a id="show-q" href="#" class="" ng-click="showFHIRQuestionnaire()">FHIR Questionnaire</a></li>--\x3e\x3c!--<li><a id="show-qr" href="#" class="" ng-click="showFHIRQuestionnaireResponse()">FHIR QuestionnaireResponse</a></li>--\x3e\x3c!--<li role="separator" class="divider"></li>--\x3e<li><a id=show-sdc-q href=# ng-click=showFHIRSDCQuestionnaire()>FHIR Questionnaire (SDC)</a></li><li><a id=show-sdc-qr href=# ng-click=showFHIRSDCQuestionnaireResponse()>FHIR QuestionnaireResponse (SDC)</a></li>\x3c!--<li role="separator" class="divider"></li>--\x3e\x3c!--<li><a href="#" class="" ng-click="showFHIRDiagnosticReport()">FHIR DiagnosticReport</a></li>--\x3e\x3c!--<li role="separator" class="divider"></li>--\x3e\x3c!--<li><a href="#" class="" ng-click="showHL7Segments()">HL7 v2 Message</a></li>--\x3e</ul></div><div ng-if=initialLoad ng-include="\'initial.html\'"></div><div ng-if=userMessages.error class=error>{{userMessages.error}}</div><div ng-if=userMessages.htmlError class=error ng-bind-html=userMessages.htmlError></div><div ng-if=userMessages.htmlWarning class=warning ng-bind-html=userMessages.htmlWarning></div><div ng-if="!initialLoad && !formData && !userMessages.error &&\n    !userMessages.htmlError" ng-include="\'loading.html\'"></div><lforms lf-data=formData lf-options=lfOptions></lforms>\x3c!-- inline templates. these could be in template files too. --\x3e<script type=text/ng-template id=initial.html><div class="loading initial">\n      <span>Please select a FHIR resource or upload from file.</span>\n    </div><\/script><script type=text/ng-template id=loading.html><div class="loading">\n      <span>Loading...</span>\n    </div><\/script>\x3c!-- end of inline templates --\x3e</div>'),e.put("fhir-app/fhir-app-navbar.html",'<div ng-controller=NavBarCtrl><div class="panel panel-default"><div class=panel-body><input type=file id=inputAnchor nv-file-select uploader=uploader class=hide><div class="btn-group btn-group-justified" role=group><a id=upload role=button type=button class="btn btn-default btn-sm btn-success" ng-click=loadFromFile() title="Upload a file."><span class="glyphicon glyphicon-upload"></span><span class=lf-nav-button>Upload</span></a></div><p>If you do not have a Questionnaire of your own to upload, you can try downloading one of our <a href=https://raw.githubusercontent.com/lhncbc/lforms-fhir-app/master/e2e-tests/data/R4/weight-height-questionnaire.json target=_blank rel="noopener noreferrer" id=sampleQ>samples</a> (saving it to file, and then uploading it here).</p></div></div><div class="panel panel-default"><div class=panel-heading><div class=panel-title>Saved QuestionnaireResponses:</div></div><div class=panel-body><div ng-if=listSavedQRError>Unable to retrieve saved QuestionnaireResponses.</div><div ng-if="!listSavedQRError && !listSavedQR">Loading QuestionnaireResponses from server...</div><div ng-if="!listSavedQRError && listSavedQR && listSavedQR.length==0">No saved QuestionnaireResponse resources were found for this patient.</div><div ng-if="listSavedQR && listSavedQR.length>0" id=qrList class=list-group><a href=# class="list-group-item {{isSelected(1, $index)}}" ng-repeat="p in listSavedQR" role=presentation id={{p.resId}} ng-click="showSavedQQR($index, p)"><p class=form-name>{{p.resName}}</p><p class=res-type ng-if=p.extensionType>{{p.resTypeDisplay}}</p><p class=last-updated>{{p.updatedAt}}</p></a><div class="btn-group btn-group-justified" role=group><a role=button type=button class="btn btn-default btn-sm glyphicon glyphicon-chevron-left" ng-disabled="!hasPagingLink(\'QuestionnaireResponse\',\'previous\')" ng-click="getPage(\'QuestionnaireResponse\', \'previous\')"></a> <a role=button type=button class="btn btn-default btn-sm glyphicon glyphicon-chevron-right" ng-disabled="!hasPagingLink(\'QuestionnaireResponse\',\'next\')" ng-click="getPage(\'QuestionnaireResponse\', \'next\')"></a></div></div></div></div><div class="panel panel-default"><div class=panel-heading><div class=panel-title>Available Questionnaires:</div></div><div class=panel-body id=qListContainer><div ng-if=listSavedQError>Unable to retrieve saved Questionnaires.</div><div ng-if="!listSavedQError && !listSavedQ">Loading Questionnaires from server...</div><div ng-if="!listSavedQError && listSavedQ && listSavedQ.length==0">No saved Questionnaire resources were found. Try uploading one.</div><div ng-if="listSavedQ && listSavedQ.length>0" id=qList class=list-group><a href=# class="list-group-item {{isSelected(2, $index)}}" ng-repeat="p in listSavedQ" role=presentation id={{p.resId}} ng-click="showSavedQuestionnaire($index, p)"><p class=form-name>{{p.resName}}</p><p class=last-updated>{{p.updatedAt}}</p></a><div class="btn-group btn-group-justified" role=group><a role=button type=button class="btn btn-default btn-sm glyphicon glyphicon-chevron-left" ng-disabled="!hasPagingLink(\'Questionnaire\',\'previous\')" ng-click="getPage(\'Questionnaire\', \'previous\')"></a> <a role=button type=button class="btn btn-default btn-sm glyphicon glyphicon-chevron-right" ng-disabled="!hasPagingLink(\'Questionnaire\',\'next\')" ng-click="getPage(\'Questionnaire\', \'next\')"></a></div><div class="btn-group btn-group-justified" role=group><a role=button type=button class="btn btn-default btn-sm btn-success" ng-click=showQuestionnairePicker($event) title="Choose a Questionnaire from the FHIR server."><span class="glyphicon glyphicon-search"></span><span class=lf-nav-button>Search</span></a></div></div></div></div></div>'),e.put("fhir-app/fhir-app.html",'\x3c!-- page header --\x3e<div id=header><a href=http://lhncbc.nlm.nih.gov title="Lister Hill Center" id=logo><img src=assets/images/lhncbc.jpg alt="Lister Hill Center"></a><div id=siteNameBox><span id=siteName>SDC Questionnaire App</span><br></div><div id=tagLine>An open-source app for Structured Data Capture Questionnaires, powered by the <a target=_blank rel=noopener href=https://lhcforms.nlm.nih.gov>LHC-Forms</a> form rendering widget</div><div id=version>Version: <a target=_blank rel="noopener noreferrer" href=https://github.com/lhncbc/lforms-fhir-app/blob/master/CHANGELOG.md>0.11.0</a></div></div>\x3c!-- end page header --\x3e<div><md-toolbar class=lf-patient><div class=md-toolbar-tools><span class="glyphicon glyphicon-user"></span> <span ng-if=getCurrentPatient() flex="" class=lf-patient-info><div id=ptName class="col-xs-6 col-md-3">Name: {{getPatientName()}}</div><div class="col-xs-6 col-md-3">Gender: {{getPatientGender()}}</div><div class="col-xs-6 col-md-3">DoB: {{getPatientDob()}}</div><div class="col-xs-6 col-md-3">Phone: {{getPatientPhone()}}</div></span></div></md-toolbar><md-content><div class=lf-content><div class="col-md-3 form-nav" ng-include="\'fhir-app/fhir-app-navbar.html\'"></div><div class="col-md-9 form-content" ng-include="\'fhir-app/fhir-app-content.html\'"></div></div></md-content></div>\x3c!-- page footer --\x3e<div id=fine-print><ul class=horz-list><li><a title="NLM copyright information" href=http://www.nlm.nih.gov/copyright.html>Copyright</a></li><li><a title="NLM privacy policy" href=http://www.nlm.nih.gov/privacy.html>Privacy</a></li><li><a title="NLM accessibility" href=http://www.nlm.nih.gov/accessibility.html>Accessibility</a></li><li><a title="NIH Freedom of Information Act office" href=http://www.nih.gov/icd/od/foia/index.htm>Freedom of Information Act</a></li><li class=last-item><a title=USA.gov href=http://www.usa.gov/ ><img src=assets/images/USAgov.gif alt=USA.gov id=usagov></a></li></ul><ul class=horz-list><li><a title="U.S. National Library of Medicine" href=http://www.nlm.nih.gov/ >U.S. National Library of Medicine</a></li><li><a title="U.S. National Institutes of Health" href=http://www.nih.gov/ >U.S. National Institutes of Health</a></li><li class=last-item><a title="U.S. Department of Health and Human Services" href=http://www.hhs.gov/ >U.S. Department of Health and Human Services</a></li></ul></div>\x3c!-- end page footer --\x3e'),e.put("fhir-app/fhir-resource-dialog.html",'<md-dialog flex=50 ng-controller=FhirAppContentCtrl><form><md-toolbar><div class=md-toolbar-tools><h2 ng-bind-html=fhirResourceTitle></h2></div></md-toolbar><md-dialog-content><div><pre id=message-body ng-bind-html=fhirResourceString></pre></div></md-dialog-content><md-dialog-actions layout=row><md-button aria-label="Copy to clipboard" ng-click="copyToClipboard(\'message-body\')" class=md-primary>Copy to Clipboard</md-button><md-button id=close-res-dialog aria-label="Close dialog" ng-click=closeDialog() class=md-primary>Close</md-button></md-dialog-actions></form></md-dialog>'),e.put("fhir-app/fhir-server-select-dialog.html",'<md-dialog flex=45><form><md-toolbar><div class=md-toolbar-tools><h2 ng-bind-html=dialogTitle></h2></div></md-toolbar><md-dialog-content><div><p>Note: The preferred way of running this app is through a SMART on FHIR launcher, such as <a href=https://apps.smarthealthit.org/app/lforms-questionnaire-app>this one</a>.</p><p>Select or Enter the base URL of a FHIR Server. A list of public <a href="http://wiki.hl7.org/index.php?title=Publicly_Available_FHIR_Servers_for_testing">FHIR server URLs</a> is available from HL7.</p><div layout=column ng-cloak><md-content layout-padding layout=column><form><input id=fhirServerURL ng-model=selectedServerInDialog autocomplete-lhc=fhirServerListOpts style="background-color: white"></form></md-content></div></div></md-dialog-content><md-dialog-actions layout=row><md-button id=btnOK aria-label=OK ng-click=confirmAndCloseDialog() class=md-primary>OK</md-button><md-button id=btnCancel aria-label=Cancel ng-click=closeDialog() class=md-primary>Cancel</md-button></md-dialog-actions></form></md-dialog>'),e.put("fhir-app/hl7-dialog.html",'<md-dialog flex=50 ng-controller=FhirAppContentCtrl><form><md-toolbar><div class=md-toolbar-tools><h2>HL7 OBR & OBX Segments</h2></div></md-toolbar><md-dialog-content><div><p>Please note that this is still a work in progress, and the code system values might be incorrect in some places.</p><pre id=message-body ng-bind-html=hl7String></pre></div></md-dialog-content><md-dialog-actions layout=row><md-button aria-label="Copy to clipboard" ng-click="copyToClipboard(\'message-body\')" class=md-primary>Copy to Clipboard</md-button><md-button aria-label="Close dialog" ng-click=closeDialog() class=md-primary>Close</md-button></md-dialog-actions></form></md-dialog>'),e.put("fhir-app/patient-select-dialog.html",'<md-dialog flex=45><form><md-toolbar><div class=md-toolbar-tools><h2 ng-bind-html=dialogTitle></h2></div></md-toolbar><md-dialog-content><div><p>{{dialogLabel}}</p><div layout=column ng-cloak><md-content layout-padding layout=column><form><md-autocomplete md-no-cache=false md-selected-item=selectedPatientInDialog md-search-text=patientSearchText md-items="item in searchPatientByName(patientSearchText)" md-item-text=item.name md-min-length=1 placeholder={{dialogHint}} md-menu-class=autocomplete-custom-template class=lf-patient-search><md-item-template><span class=item-title><span class="glyphicon glyphicon-user"></span> <span class=item-property><strong>{{item.name}} </strong></span></span><span class=item-metadata><span class=item-property>Gender: <strong>{{item.gender}}</strong> </span><span class=item-property>DoB: <strong>{{item.dob}}</strong> </span><span class=item-property>Phone: <strong>{{item.phone}}</strong></span></span></md-item-template><md-not-found>No patients found.</md-not-found></md-autocomplete></form></md-content></div></div></md-dialog-content><md-dialog-actions layout=row class=lost-data-warning ng-if="differentPatient(selectedPatient, selectedPatientInDialog)"><span>* Unsaved data in the form will be lost if you change to a different patient.</span> <span flex></span></md-dialog-actions><md-dialog-actions layout=row><md-button id=btnOK ng-if=selectedPatientInDialog aria-label=OK ng-click=confirmAndCloseDialog() class=md-primary>OK</md-button><md-button id=btnCancel aria-label=Cancel ng-click=closeDialog() class=md-primary>Cancel</md-button></md-dialog-actions></form></md-dialog>'),e.put("fhir-app/questionnaire-select-dialog.html",'<md-dialog flex=45><form><md-toolbar><div class=md-toolbar-tools><h2 ng-bind-html=dialogTitle></h2></div></md-toolbar><md-dialog-content><div><p>{{dialogLabel}}</p><div layout=column ng-cloak><md-content layout-padding layout=column><form><md-autocomplete md-no-cache=false md-selected-item=selectedQuestionnaireInDialog md-search-text=questionnaireSearchText md-items="item in searchQuestionnaireByName(questionnaireSearchText)" md-item-text=item.name md-min-length=1 placeholder={{dialogHint}} md-menu-class=autocomplete-custom-template class=lf-patient-search><md-item-template><span class=item-title><span class="glyphicon glyphicon-user"></span> <span class=item-property><strong>{{item.name}} </strong></span></span><span class=item-metadata><span class=item-property>Status: <strong>{{item.status}}</strong></span></span></md-item-template><md-not-found>No Questionnaires found.</md-not-found></md-autocomplete></form></md-content></div></div></md-dialog-content><md-dialog-actions layout=row class=lost-data-warning ng-if="differentQuestionnaire(selectedQuestionnaire, selectedQuestionnaireInDialog)"><span>* Unsaved data in the form will be lost if you choose a difference Questionnaire.</span> <span flex></span></md-dialog-actions><md-dialog-actions layout=row><md-button id=btnOK ng-if=selectedQuestionnaireInDialog aria-label=OK ng-click=confirmAndCloseDialog() class=md-primary>OK</md-button><md-button id=btnCancel aria-label=Cancel ng-click=closeDialog() class=md-primary>Cancel</md-button></md-dialog-actions></form></md-dialog>'),e.put("fhir-app/save-results-dialog.html","<md-dialog flex=45 ng-controller=FhirAppContentCtrl><form><md-toolbar><div class=md-toolbar-tools><h2 ng-bind-html=dialogTitle></h2></div></md-toolbar><md-dialog-content><div><p>Save {{resultData.error && resultData.successfulResults ? 'partially ' : ''}}{{ resultData.error ? 'failed' : 'succeeded'}}.</p><ul ng-repeat=\"result in resultData.successfulResults\"><li ng-repeat=\"entry in result.data.entry\">\x3c!-- bundle --\x3e {{entry.response.status.slice(4)}} <a href={{serverBaseURL}}/{{entry.response.location}} target=_blank>{{entry.response.location}}</a></li><li ng-if=\"result.data.resourceType != 'Bundle'\">{{result.config.method='POST' ? 'Created' : result.config.method='PUT' ? 'Updated' : result.config.method}} <a href={{serverBaseURL}}/{{result.data.resourceType}}/{{result.data.id}} target=_blank>{{result.data.resourceType}}/{{result.data.id}}</a></li></ul><a href=# onclick=\"$('#details').toggle(); $('#copyBtn').toggle(); return false\">Details</a><pre id=details style=\"display: none\">{{resultDataJSON}}</pre></div></md-dialog-content><md-dialog-actions layout=row><md-button id=copyBtn aria-label=\"Copy to clipboard\" style=\"display: none\" ng-click=\"copyToClipboard('details')\" class=md-primary>Copy to Clipboard</md-button><md-button id=btnOK aria-label=OK ng-click=closeDialog() class=md-primary>OK</md-button></md-dialog-actions></form></md-dialog>")}]);